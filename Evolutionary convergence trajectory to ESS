syms x y z a b b1 b2 w1 w2 w3 w4 c1 c2 B q I;

% parameter setting
params = struct('a', 0.4, 'b', 0.9, 'b1', 0.2, 'b2', 0.05, ...
                'w1', 0.9, 'w2', 1.2, 'w3', 1.2, 'w4', 0.9, ...
                'c1', 0.4, 'c2', 0.1, 'B', 0.8, 'q', 0.15, 'I', 1);

v11 = (w1*(I+B)-c1)*(1-a-b1)*y*z + (w2*(I+B)-c1)*(1-a-b2)*y*(1-z) + ...
      (b*w1*(I+B)-c1)*(1-a-b1)*(1-y)*z + (b*w2*(I+B)-c1)*(1-a-b2)*(1-y)*(1-z);
v12 = (w3*I)*(1-a-b1)*y*z + (w4*I)*(1-a-b2)*y*(1-z) + ...
      (b*w3*I)*(1-a-b1)*(1-y)*z + (b*w4*I)*(1-a-b2)*(1-y)*(1-z);
v1 = simplify(x*v11 + (1-x)*v12);
fx = simplify(x*(v11-v1));

v21 = x*z*(a*(w1*(I+B)-c1)) + x*(1-z)*(a*(w2*(I+B)-c1)) + ...
      (1-x)*z*(a*w3*I) + (1-x)*(1-z)*(a*w4*I);
v22 = x*z*(a*(b*w1*(I+B)-c1)-q) + x*(1-z)*(a*(b*w2*(I+B)-c1)) + ...
      (1-x)*z*(a*(b*w3*I)-q) + (1-x)*(1-z)*(a*b*w4*I);
v2 = simplify(y*v21 + (1-y)*v22);
fy = simplify(y*(v21-v2));

v31 = x*y*(b1*(w1*(I+B)-c1)-c2) + x*(1-y)*(b1*(b*w1*(I+B)-c1)+q-c2) + ...
      (1-x)*y*(b1*w3*I-c2) + (1-x)*(1-y)*(b1*(b*w3*I)-c2+q);
v32 = x*y*(b2*(w2*(I+B)-c1)) + x*(1-y)*(b2*(b*w2*(I+B)-c1)) + ...
      (1-x)*y*(b2*w4*I) + (1-x)*(1-y)*(b2*b*w4*I);
v3 = simplify(z*v31 + (1-z)*v32);
fz = simplify(z*(v31-v3));

fx_func = matlabFunction(fx, 'Vars', [x, y, z, a, b, b1, b2, w1, w2, w3, w4, c1, c2, B, q, I]);
fy_func = matlabFunction(fy, 'Vars', [x, y, z, a, b, b1, b2, w1, w2, w3, w4, c1, c2, B, q, I]);
fz_func = matlabFunction(fz, 'Vars', [x, y, z, a, b, b1, b2, w1, w2, w3, w4, c1, c2, B, q, I]);

P = [params.a, params.b, params.b1, params.b2, params.w1, params.w2, ...
     params.w3, params.w4, params.c1, params.c2, params.B, params.q, params.I];

% 150times simulation
tspan = [0 50];
numPaths = 150; 

figure; hold on;
xlabel('x (Brand)'); ylabel('y (MCN)'); zlabel('z (Platform)');
title('Evolution Path of Three-Party Strategies');
grid on;

set(gca, 'YTick', 0:0.2:1);

% random path
for i = 1:numPaths
    % random probability between 0 to 1
    x0 = rand; y0 = rand; z0 = rand;

    dynamics = @(t, X) [
        fx_func(X(1), X(2), X(3), P(1), P(2), P(3), P(4), P(5), P(6), P(7), P(8), P(9), P(10), P(11), P(12), P(13));
        fy_func(X(1), X(2), X(3), P(1), P(2), P(3), P(4), P(5), P(6), P(7), P(8), P(9), P(10), P(11), P(12), P(13));
        fz_func(X(1), X(2), X(3), P(1), P(2), P(3), P(4), P(5), P(6), P(7), P(8), P(9), P(10), P(11), P(12), P(13))
    ];

    % solve
    [t, X] = ode45(dynamics, tspan, [x0, y0, z0]);

    
    plot3(X(:,1), X(:,2), X(:,3), 'LineWidth', 1.2);
end

view(3); hold off;
